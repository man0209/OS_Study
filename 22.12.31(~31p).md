# CPU의 가상화
- 운영체제가 적은 수의 CPU를 각 프로세스마다 각자의 CPU가 있는 것처럼 환상을 만들어 내는 것
- 어떻게?
  - 시분할 (time sharing)을 통해서!!
- 시분할이란?
  - 하나의 프로세스를 실행하고, 얼마 후 중단시키고 다른 프로세스를 실행하고... 이러한 작업을 반복하면서 실제 하나 또는 소수의 CPU로 여러 개의 가상 CPU가 존재하는 듯한 환상을 만들어 낸다.  
  - 다만 시분할 기법은 CPU를 공유하기 때문에, 각 프로세스의 성능은 낮아진다.
  - 이 시분할 기법은 모든 현대 운영체제들이 사용하고 있다.
- CPU 가상화의 효율적 구현을 위해서는 무엇이 필요할까?
  - 도구 와 지능
  - 도구(mechanism)란?
    - 필요한 기능을 구현하는 방법. >> 시분할 기법
  - 지능은 정책(policy)의 형태로 표현
    - 정책이란 운영체제에서 어떤 결정을 내리는 데 사용되는 알고리즘.
    - 예를 들어, 다수의 실행가능한 프로그램이 존재할 때, 운영체제는 어느 프로그램을 선택해서 실행시켜야 할까?
    - 운영체제의 스케줄링 정책(scheduling policy)이 이러한 결정을 내린다.

# 프로세스의 개념
- 실행 중인 프로그램 >> 프로세스(process)
- 프로세스의 구성 요소
  - 메모리 (프로세스가 접근할 수 있는)
    - 프로세스의 하드웨어 상태 중 가장 중요한 구성 요소
    - 명령어는 메모리에 저장
    - 프로세스가 읽고 쓰는 데이터 역시 메모리에 저장      
  - 레지스터
    - 많은 명령어들이 레지스터를 직접 읽거나 갱신
    - 특별한 레지스터들이 존재
    - 프로그램 카운터(program counter, PC)
      - 프로그램의 어느 명령어가 실행 중인지를 알려준다.
      - 프로그램 카운터는 명령어 포인터(instruction pointer, IP)라고도 불린다.
    - 스택 포인터(stack pointer), 프레임 포인터(frame pointer)
      - 함수의 변수와 리턴 주소를 저장하는 스택을 관리할 때 사용하는 레지스터

# 프로세스 API
- 모든 현대 운영체제에서 제공되는 기본 기능에 대한 API에 대해 간단히 살펴보자
- 생성(create), 제거(destory), 대기(wait), 각종 제어(miscellaneous control), 상태(status)

# 프로세스 생성
- 운영체제는 프로그램을 어떻게 프로세스로 변형시킬까???
- 첫번째 작업 >> 디스크에 있는 프로그램 코드, 정적 데이터(static data, 예를 들어, 초기값을 가지는 변수)를 프로세스가 사용하는 메모리에 탑재(load)하는 것.
- <img width="415" alt="스크린샷 2022-12-31 오후 3 38 09" src="https://user-images.githubusercontent.com/69157076/210127764-2f180a1e-e873-4b97-b29d-1a23654e26e4.png">
- 즉, 어떤 프로그램이든 실행시키기 전에 운영체제는 프로그램의 중요 부분을 디스크에서 메모리로 탑재해야 한다.
- 두번째 작업 >> 특정 크기의 메모리 공간이 프로그램에 스택(run-time stack, 혹은 그냥 스택)용도로 할당되어야 한다.
  - 지역 변수, 함수 인자, 리턴 주소 등을 저장하기 위해 스택을 사용, 운영체제는 스택을 주어진 인자로 초기화
- 세번째 작업 >> 프로그램의 힙(heap)을 위한 메모리 영역을 할당
  - 사용할 만큼 요청하고, 사용 후 다른 프로그램이 사용할 수 있게 반환 
- 네번째 작업 >> 입출력과 관계된 초기화 작업
- 위 과정을 모두 마치게 되면, 운영체제는 프로그램 실행을 위한 준비를 마치게 된다.
- 운영체제는 CPU를 새로 생성된 프로세스에게 넘기게 되고 프로그램 실행이 시작된다.

# 프로세스 상태
- 다음 세 상태 중 하나에 존재할 수 있다.
- 실행(Running)
  - 실행 상태에서 프로세스는 프로세서에서 실행 중이다. 즉, 프로세스는 명령어를 실행하고 있다.
- 준비(Ready)
  - 준비 상태에서 프로세스는 실행할 준비가 되어 있지만 운영체제가 다른 프로세스를 실행하고 있는 등의 이유로 대기 중.
- 대기(Blocked)
  - 프로세스가 다른 사건을 기다리는 동안 프로세스의 수행을 중단시키는 연산. 

- <img width="285" alt="스크린샷 2022-12-31 오후 3 59 48" src="https://user-images.githubusercontent.com/69157076/210128305-a2c63cdc-65a4-4a51-8494-f9cc5f8bf6cc.png">





 
